---
title: "p8105_hw2_yh3964"
author: "Yirou Hu"
date: "2025-09-26"
output: github_document
---
# Problem 0
We import the datasets and create all the required files with name. 
```{r}
library(tidyverse)
library(readxl)
```

# Problem 1
We will do data cleaning for pols-month.csv firstly. 

- break up the variable mon into integer variables year, month, and day; 
- replace month number with month name; 
- create a president variable taking values gop and dem, 
- remove prez_dem and prez_gop
- remove the day variable.

```{r}
pols_month = read_csv("fivethirtyeight_datasets/pols-month.csv") |>
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    month = case_match(
      month, 
    "01"~"Jan",
    "02"~"Feb",
    "03"~"Mar",
    "04"~"Apr",
    "05"~"May",
    "06"~"Jun",
    "07"~"Jul",
    "08"~"Aug",
    "09"~"Sep",
    "10"~"Oct",
    "11"~"Nov",
    "12"~"Dec")
  )|>
  mutate(
    president=case_match(
      prez_gop,
    0~"dem",
    1~"gop",
    2~"gop"
    )
  )|>
  mutate(year = as.integer(year), day = as.integer(day)) |>
  select(-c("day", "prez_gop", "prez_dem"))
```

Second, clean the data in snp.csv
- arrange according to year and month.
- organize so that year and month are the leading columns.

```{r}
snp = read.csv("fivethirtyeight_datasets/snp.csv") |>
  janitor::clean_names() |>
  separate(date, into = c("month", "day", "year"), sep = "/" ) |>
  mutate(month = as.integer(month), year = as.integer(year)) |>
  arrange(year, month) |>
  mutate(
    month = case_match(
      month,
      1 ~ "Jan",
      2 ~ "Feb",
      3 ~ "Mar",
      4 ~ "Apr",
      5 ~ "May",
      6 ~ "Jun",
      7 ~ "Jul",
      8 ~ "Aug",
      9 ~ "Sep",
      10 ~ "Oct",
      11 ~ "Nov",
      12 ~ "Dec"
    )) |>
  relocate(year, month) |>
  select(-"day")

```

Third, tidy the unemployment data so that it can be merged with the previous datasets.

- This process will involve switching from “wide” to “long” format; 
- ensuring that key variables have the same name; 
- and ensuring that key variables take the same values.

```{r}
unemployment = 
  read_csv("fivethirtyeight_datasets/unemployment.csv") |>
  rename(year = Year) |>
  pivot_longer(
    Jan:Dec, 
    names_to = "month",
    values_to = "unemployment"
  ) 
  
```

```{r}
Joint_df = 
  left_join(
  x = left_join(pols_month,snp, by = c("year", "month")), 
  y = unemployment, by = c("year", "month")
  )
```

It’s important to note that the close and unemployment variables contain some NA values, which mean the corresponding values are missing at those positions.

In detail:

- The pols data has `r nrow(pols_month)` observations and `r ncol(pols_month)` variables. It records the party affiliation for each year from 1947 to 2015.
- The snp data has `r nrow(snp)` observations and `r ncol(snp)` variables, covering years from `r range(snp$year)[1]` to `r range(snp$year)[2]`, and it contains information related to the S&P stock market index.
- The unemployment data has `r nrow(unemployment)` observations and `r ncol(unemployment)` variables, spanning `r range(unemployment$year)[1]` to `r range(unemployment$year)[2]`, and it tracks monthly unemployment rates.
- The pols_month dataset is a simplified version focusing on the president’s party affiliation. It has `r nrow(pols_month)` rows and `r ncol(pols_month)` columns, with years ranging from `r range(pols_month$year)[1]` to `r range(pols_month$year)[2]`.
- The merged Joint_df dataset combines pols_month, snp, and unemployment. It has `r nrow(Joint_df)` rows and `r ncol(Joint_df)` columns, covering years from `r range(Joint_df$year)[1]` to `r range(Joint_df$year)[2]`.

In addition, we can compare the average unemployment value in a random year with two party affiliations. For Decembers after 2002, the average unemployment rate when a Democrat was president was `r filter(Joint_df, month == "Dec", year >= 2002, president == "dem") |> pull(unemployment) |> mean()`. Furthermore, the average unemployment rate when a Republican was president was `r filter(Joint_df, month == "Dec", year >= 2002, president == "gop") |> pull(unemployment) |> mean()`. 


# Problem 2

Read and clean the Mr. Trash Wheel sheet:

- specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
- use reasonable variable names
- omit rows that do not include dumpster-specific data
- round the number of sports balls to the nearest integer and converts the result to an integer variable (using as.integer)

```{r}
#readxl::read_excel("202409 Trash Wheel Collection Data.xlsx",sheet = "Mr. Trash Wheel",range ="A2:N586", na = c("NA", "", ".")) |>
trash_wheel_df =
  readxl::read_excel("202409 Trash Wheel Collection Data.xlsx",sheet = "Mr. Trash Wheel",range ="A2:N586") |>
  janitor::clean_names() |>
  mutate(
    year = as.integer(year),
    homes_powered = weight_tons*500/30,
    sports_balls = as.integer(round(sports_balls)), 
    trash_wheel = "Mr. Trash Wheel",
    ) |> 
  drop_na(dumpster)
```

Read and clean Professor Trash Wheel dataset

```{r}
prof_df = 
  #read_excel("202409 Trash Wheel Collection Data.xlsx", 
  #           sheet = "Professor Trash Wheel",
  #          range = "A2:M120",
  #           na = c("NA", "", ".")) |> 
  readxl::read_excel("202409 Trash Wheel Collection Data.xlsx", 
             sheet = "Professor Trash Wheel",
             range = "A2:M120"
             ) |>
  janitor::clean_names() |> 
  mutate(
    trash_wheel = "Professor", 
    year = as.numeric(year),
    homes_powered = weight_tons * 500 / 30
    ) |> 
  select(-dumpster)
```

Read and clean Gwynnda dataset

```{r}
gwynnda_df = 
  readxl::read_excel("202409 Trash Wheel Collection Data.xlsx", 
             sheet = "Gwynnda Trash Wheel",
             range = "A2:L265",
             na = c("NA", "", ".")) |> 
  janitor::clean_names() |> 
  drop_na(dumpster) |>
  mutate(
    trash_wheel = "Gwynnda",
    year = as.numeric(year),
    homes_powered = weight_tons * 500 / 30
    )
```

